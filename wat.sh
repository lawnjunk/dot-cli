#!/bin/bash
rtrim() #{{{1;{;    # <doc:rtrim> {{{;    #;    # Removes all trailing whitespace (from the right).;    #;    # </doc:rtrim> }}};;    local char=${1:-[:space:]};    sed "s%[${char//%/\%}]*$%%";};ltrim() #{{{1;{;    # <doc:ltrim> {{{;    #;    # Removes all leading whitespace (from the left).;    #;    # </doc:ltrim> }}};;    local char=${1:-[:space:]};    sed "s%^[${char//%/\%}]*%%";};trim() #{{{1;{;    # <doc:trim> {{{;    #;    # Removes all leading/trailing whitespace;    #;    # Usage examples:;    #     echo "  foo  bar baz " | trim  #==> "foo  bar baz";    #;    # </doc:trim> }}};;    ltrim "$1" | rtrim "$1";};squeeze() #{{{1;{;    # <doc:squeeze> {{{;    #;    # Removes leading/trailing whitespace and condenses all other consecutive;    # whitespace into a single space.;    #;    # Usage examples:;    #     echo "  foo  bar   baz  " | squeeze  #==> "foo bar baz";    #;    # </doc:squeeze> }}};;    local char=${1:-[[:space:]]};    sed "s%(${char//%/\%})+%1%g" | trim "$char";};abspath() #{{{1;{;    # <doc:abspath> {{{;    #;    # Gets the absolute path of the given path.;    # Will resolve paths that contain '.' and '..'.;    # Think readlink without the symlink resolution.;    #;    # Usage: abspath [PATH];    #;    # </doc:abspath> }}};;    local path=${1:-$PWD};;    # Path looks like: ~user/...;    # Gods of bash, forgive me for using eval;    if [[ $path =~ ~[a-zA-Z] ]]; then;        if [[ ${path%%/*} =~ ^~[[:alpha:]_][[:alnum:]_]*$ ]]; then;            path=$(eval echo $path);        fi;    fi;;    # Path looks like: ~/...;    [[ $path == ~* ]] && path=${path/~/$HOME};;    # Path is not absolute;    [[ $path != /* ]] && path=$PWD/$path;;    path=$(squeeze "/" <<<"$path");;    local elms=();    local elm;    local OIFS=$IFS; IFS="/";    for elm in $path; do;        IFS=$OIFS;        [[ $elm == . ]] && continue;        if [[ $elm == .. ]]; then;            elms=("${elms[@]:0:$((${#elms[@]}-1))}");        else;            elms=("${elms[@]}" "$elm");        fi;    done;    IFS="/";    echo "/${elms[*]}";    IFS=$OIFS;};;function main(){;  abspath "$1";};;main "$1";
